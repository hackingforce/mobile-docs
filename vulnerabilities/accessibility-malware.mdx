export const metadata = {
    title: 'Vulnerabilidades: Malware de Acessibilidade'
}

# Malware de Acessibilidade
A API de serviços de acessibilidade do Android foi originalmente desenvolvida para aprimorar a experiência de uso de pessoas com necessidades especiais, permitindo que aplicativos leiam informações exibidas na tela e controlem gestos, entre outras funcionalidades. No entanto, essa interface tem sido amplamente explorada por aplicativos maliciosos (malware) para acessar indevidamente informações pessoais e sensíveis dos usuários.

Nessa página vamos abordar como os malwares de acessibilidade funcionam e como podemos mitigar essas ameaças.

## Mitigação
Recomenda-se implementar verificações rigorosas da presença e confiabilidade dos serviços de acessibilidade ativos antes de exibir informações sensíveis na interface do usuário. Para isso, é essencial manter uma lista de serviços de acessibilidade autorizados, que poderão receber eventos gerados pelo aplicativo.

Com a introdução do Android 14 (API 34), a propriedade `accessibilityDataSensitive` foi lançada, permitindo restringir automaticamente a exibição de elementos sensíveis a serviços de acessibilidade homologados pelo Google. A implementação pode ser realizada da seguinte forma:
```xml
<TextView
  android:id="@+id/creditcard"
  android:text="5425233430109903"
  android:accessibilityDataSensitive="yes" 
/>
```

## Serviços

```xml showLineNumbers {3-10}
<manifest ... >
    <application ... >
        <service
            android:name=".Main"
            android:exported="true"
            android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE">
            <intent-filter>
                <action android:name="android.accessibilityservice.AccessibilityService" />
            </intent-filter>
        </service>
    </application>
</manifest>
```

```kotlin showLineNumbers {9} filename="Acessibility.kt"
package poc.malware

import android.accessibilityservice.AccessibilityService
import android.util.Log
import android.view.accessibility.AccessibilityEvent
import android.view.accessibility.AccessibilityNodeInfo

class Main : AccessibilityService() {
    private val tag = "Malware"

    override fun onAccessibilityEvent(event: AccessibilityEvent?) {
        event?.let {
            if (it.eventType == AccessibilityEvent.TYPE_WINDOW_STATE_CHANGED) {
                val rootNode: AccessibilityNodeInfo? = rootInActiveWindow
                rootNode?.let { root ->
                    findAndPerformAction(root)
                }
            }
        }
    }
}
```